<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>movie search engin2</title>
</head>

<style>
    * {
        color: white;
        background-color: black;
    }

    input {
        width: 200px;
    }

    #movies {
        height: 200px;
        width: 410px;
        border: 1px solid black;
        overflow: scroll;
        border-top: none;
        display: none;
    }

    #details {
        width: 80%;
        height: 300px;
        display: grid;
        grid-template-columns: 29% 60%;
        grid-gap: 5px;
        margin: 20px auto;
        justify-content: center;
    }

    #details img {
        width: 100%;
        height: 320px;
    }

    #details div {
        /* border: 2px solid grey; */
        background-color: grey;
        border-radius: 5px;
        color: black;


    }

    #details p {
        margin-left: 30px;
        margin-top: 20px;
        background-color: grey;
        color: black;
        font-weight: bold;
    }

    #maindiv {
        width: 300px;
        margin: auto;
        display: flex;
        flex-direction: column;
        /* text-align: center; */
    }

    #search input {
        width: 400px;
        height: 25px;
        /* font-size: 20px; */
        border: 2px solid gray;
    }
    #error{
        width: 700px;
        height: 400px;
        margin: 15px auto;
    }
    #error img{
        width: 100%;
        height: 100%;
    }
</style>

<body>
    <div id="maindiv">
        <div id="search">
            <input oninput="debounce(main,1000)" type="text" id="movie" placeholder="Enter movie name" />
        </div>
        <div id="movies"></div>
    </div>
    <div id="details"></div>
    <div id="error"></div>
</body>

</html>

<script>

    //search Movies => done

    var timerId;

    let movies_div = document.getElementById("movies");

    async function searchMovies(movie_name) {
        try {
            let res = await fetch(`https://www.omdbapi.com/?apikey=65714494&s=${movie_name}`);
            let data = await res.json();
            console.log("data-----:", data);

            return data;
        } catch (e) {
            // alert("not found")
            console.log("e:", e)
        }

    }

    // searchMovies("inception");
    var movie_details = document.getElementById("details");
    var errorData = document.getElementById("error");

    function appendMovies(movies) {

        errorData.innerHTML = null;

        movies_div.innerHTML = null;

        if (movies === undefined) {
            errorData.innerHTML = null;
            movie_details.innerHTML = null;
            movie_details.style.display = "none";
            // alert("Not found");
            let div = document.createElement("div");

            let img = document.createElement("img");

            img.src = "https://miro.medium.com/max/1200/1*cLQUX8jM2bMdwMcV2yXWYA.jpeg";
            console.log("img--",img)

            errorData.append(img);

        } else {

            movie_details.style.display = "grid";


            movies.forEach(function (movie) {
                let p = document.createElement("p");

                p.innerText = movie.Title;
                movies_div.append(p);


                p.addEventListener("click", function () {
                    // p.style.color = "red";
                    console.log("acccs:", movie);
                    

                    movie_details.innerText = null;



                    imb(movie.imdbID);

                    async function imb(IMDbId) {
                        let res = await fetch(`http://www.omdbapi.com/?i=${IMDbId}&apikey=65714494`);
                        let data = await res.json();
                        console.log("data---", data);

                        let left = document.createElement("div");
                        let right = document.createElement("div");

                        let img = document.createElement("img");

                        img.src = data.Poster;

                        left.append(img);

                        let name = document.createElement("p");

                        name.innerText = "Title: " + data.Title;

                        name.setAttribute("style", "font-size:20px; font-weight:bold;")

                        let Released = document.createElement("p");

                        Released.innerText = "Year: " + data.Released;

                        let imdbID = document.createElement("p");
                        imdbID.setAttribute("style", "color:gold;");
                        imdbID.innerText = "imdbID: " + data.imdbRating + "*";

                        let Language = document.createElement("p");

                        Language.innerText = "Language: " + data.Language;

                        let Runtime = document.createElement("p");

                        Runtime.innerText = "Runtime: " + data.Runtime;

                        let Actors = document.createElement("p");

                        Actors.innerText = "Actors: " + data.Actors;

                        let Writer = document.createElement("p");

                        Writer.innerText = "Writer: " + data.Writer;

                        right.append(name, Released, Language, imdbID, Runtime, Actors, Writer);
                        movie_details.append(left, right);
                    }



                });
            });
        }

    }

    async function main() {
        let name = document.getElementById("movie").value;

        //get search movies

        if (name.length < 3) {
            return false;
        }

        movies_div.style.display = "block";

        // movies_div.addEventListener("mouseenter",()=>{
        //     movies_div.style.display = "block"
        // })



        let res = await searchMovies(name);

        let movie_data = res.Search;
        appendMovies(movie_data);
        console.log("res---", movie_data);


    }


    function debounce(func, delay) {

        //lets take about A
        //func = main()

        //ave = setTimeout -  func - main- searchMovie("ave")
        //aven - clear the previous timeout - setTimeout - func - main- searchMovie("ave")

        if (timerId) {
            clearTimeout(timerId);
        }


        timerId = setTimeout(function () {

            func();

        }, delay);

    }

    // let errorMovie = document.getElementById("error");

    // function errorDisplay() {

    // }

</script>